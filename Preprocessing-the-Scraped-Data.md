## Table of Contents <a name="table"></a>
1. [Description](#description) 
1. [Input Files](#input) 
1. [Overview of Class, SuperClass, and Main function](#class)
1. [Deliveroo and Kukd Preprocessors](#deliverookukd)
1. [Facebook Marketplace Preprocessor](#fb)
1. [Potential Improvements](#improvements)

## Description <a name="description"></a>

The data preprocessing is automated by _FHRSOP.py_'s commands. Currently, the preprocessors are saved in three files: _DeliverooPreprocessor.py_, _FbmkplacePreprocessor.py_, and _KukdPreprocessor.py_. These files contain class objects, and these objects operate on the raw .json outputs from the corresponding platforms from the scraping stage. The complete data preprocessing stage outputs cleaned data in pandas dataframe format as well as .csv files.

[Go to Top](https://github.com/S2DSLondon/Aug20_FSA/wiki/Preprocessing-the-Scraped-Data#table)

## Input Files <a name="source"></a>

The preprocessing stage takes into the input raw .json files saved in path ``../data/raw``.

[Go to Top](https://github.com/S2DSLondon/Aug20_FSA/wiki/Preprocessing-the-Scraped-Data#table)

## Overview of Class, SuperClass, and Main function <a name="class"></a>

The three preprocessor output classes (Class DeliverooPreprocessor, Class FbmkplacePreprocessor, Class KukdPreprocessor) inherit from the super-Class Preprocessor (saved in _Preprocessor.py_). For simplicity, and unless stated otherwise, the three aforementioned classes will be called 'output class' in this documentation. The super-Class Preprocessor returns the raw .json file-paths from the scraping stage, and the output classes preprocess the .json files into a cleaned dataframe.

The whole preprocessing process is automated by initiating the `main` function in _preprocess.py_. All output dataframes have the same columns:

> `PlatformBusinessName`, `PlatformBusinessAddress`, `PlatformPostCode`, `PlatformName`, `PlatformFHRSID`, `PlatformRatingValue`, `PlatformRating`,
 `PlatformTags`, `PlatformDescription`, `ScrapingSearch`, `ScrapingTime`

[Go to Top](https://github.com/S2DSLondon/Aug20_FSA/wiki/Preprocessing-the-Scraped-Data#table)

## Deliveroo and Kukd Preprocessors <a name="deliverookukd"></a>

_DeliverooPreprocessor.py_ and _KukdPreprocessor.py_ are designed to preprocess data from the Delivero and Kukd website, respectively, into dataframes. The class object takes the raw .json file and cleans the data. See below for a sample cleaned data from these preprocessors:

|Variable Name          |Variable Definition                                                                                                                        |Variable Example                                                                                                                                                                                                                               |Variable Preprocessing Notes                                            |
|-----------------------|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
|PlatformBusinessName   |restaurant name                                                                                                                            |Dishoom                                                                                                                                                                                                                                       |name only, no location or special characters                            |
|PlatformBusinessAddress|address of the restaurant                                                                                                                  |123 Caledonia Road, London, UK, EC1H 2WX                                                                                                                                                                                                      |raw output with little processing                                       |
|PlatformPostCode       |strict formatted postcode in uppercase and with a space in between in-code and out-code                                                     |E1 6AW                                                                                                                                                                                                                                        |raw output with little processing                                       |
|PlatformName           |name of the platform                                                                                                                       |Deliveroo / Kukd                                                                                                                                                                                                                              |raw output                                                              |
|PlatformFHRSID         |FHSRID shown on the platform                                                                                                               |12076                                                                                                                                                                                                                                         |raw output; only available in Deliveroo                                 |
|PlatformRatingValue    |FHRS rating from the platform. empty for the time being as there's no established benchmark (e.g. Deliveroo hygiene filter slider on front page or redundant info as the FHRS score banner on Deliveroo is linked to the FSA API)|NA                                                                                                                                                                                                                                            |hard coded                                                              |
|PlatformRating         |restaurant review rating listed on the platform                                                                                            |4.3                                                                                                                                                                                                                                           |change to numerical type                                                |
|PlatformTags           |list of food types listed on the platform                                                                                                  |['Chicken', 'Vegan', 'Mexican']                                                                                                                                                                                                               |raw output with processing if needed                                    |
|PlatformDescription    |description given on the platform                                                                                                          |Created under the guidance of Michelin-starred chef, Nacho Manzano, IbÃ©ricaâ€™s dishes are made using the finest ingredients from Spain. With modern takes on traditional classics, the menu showcases the best of contemporary Spanish cuisine.|raw output with processing if needed                                    |
|ScrapingSearch         |scraped keyword search on the platform                                                                                                     |E1 6AW                                                                                                                                                                                                                                        |raw output with processing if needed (e.g. multiple search terms concatenated)|
|ScrapingTime           |time when the .json (raw data) file is produced                                                                                             |2020/08/12 11::00:00                                                                                                                                                                                                                          |raw output                                                              |

[Go to Top](https://github.com/S2DSLondon/Aug20_FSA/wiki/Preprocessing-the-Scraped-Data#table)

## Facebook Marketplace Preprocessor <a name="fb"></a>

The _FbmktplacePreprocessor.py_ is slightly different from the previous two preprocessors. The main difference is that data from the Facebook Marketplace contain no addresses, no postcodes, and no definite business names; instead, the data mainly contains descriptive texts. However, to achieve a relatively uniform output, the data from the Facebook Marketplace are still preprocessed into the same dataframe structure as the previous two preprocessors, in the format shown in the table below.

|Variable Name          |Variable Definition                                                                                                                        |Variable Sample                                                                                                                                                                                                                               |Variable Preprocessing Notes                                            |
|-----------------------|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
|PlatformBusinessName   |heading on the marketplace post                                                                                                            |homemade original food ðŸ¥˜ punjabi style                                                                                                                                                                                                       |extensive processing getting rid of editor styles (e.g \n, \\n) url, decode unicodes for symbols and emojis|
|PlatformBusinessAddress|Geographical area                                                                                                                          |Ilford, England                                                                                                                                                                                                                               |raw output                                                              |
|PlatformPostCode       |NA                                                                                                                                         |                                                                                                                                                                                                                                              |                                                                        |
|PlatformName           |name of the platform                                                                                                                       |FBmarketplace                                                                                                                                                                                                                                 |raw output                                                              |
|PlatformFHRSID         |NA                                                                                                                                         |                                                                                                                                                                                                                                              |                                                                        |
|PlatformRatingValue    |NA                                                                                                                                         |                                                                                                                                                                                                                                              |                                                                        |
|PlatformRating         |NA                                                                                                                                         |                                                                                                                                                                                                                                              |                                                                        |
|PlatformTags           |NA                                                                                                                                         |                                                                                                                                                                                                                                              |                                                                        |
|PlatformDescription    |description given on the platform                                                                                                          |ðŸ˜‹  ...fresh and very delicious homemade Asian food chicken Manchurian                                                                                                                                                                        |extensive processing getting rid of editor styles (e.g \n, \\n) URL, decode unicodes for symbols and emojis|
|ScrapingSearch         |scraped keyword search on the platform                                                                                                     |london + homemade food                                                                                                                                                                                                                        |raw output with processing if needed (e.g. multiple search terms concatenated)|
|ScrapingTime           |time when the .json (raw data) file is produced                                                                                             |2020/08/12 11::00:00                                                                                                                                                                                                                          |raw output                                                              |

[Go to Top](https://github.com/S2DSLondon/Aug20_FSA/wiki/Preprocessing-the-Scraped-Data#table)

## Potential Improvements <a name="improvements"></a>

* There is a fair amount of encoding and decoding of **unicodes (symbols and emojis)** in the data from Facebook Marketplace. This is done by registering the escape ``\`` key in the .json file. There is also quite a lot of regex processing for different **URLs**. <br> As the text conversion of marketplace posts to dataframe requires extensive cleaning, in situations where there are unexpected escape signs, the preprocessor may not decode the text properly (this happened once when scraping the net with the search term "london, takeaway food").

* As mentioned previously, we have opted for a **uniform output** from our preprocessors despite the significant differences in the input information as this facilitates further processes down the pipeline. This means that some effort needs to be put into adapting the scrape data into the specific format - and, due to the particularities of each website, there is no universal method that applies. This approach might have to be reconsidered in future developments.

[Go to Top](https://github.com/S2DSLondon/Aug20_FSA/wiki/Preprocessing-the-Scraped-Data#table)